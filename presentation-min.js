/*!
 * Presentation Framework
 * Version: 0.1
 *
 * Copyright 2011, George Walters II
 * Licensed under MIT Version 2
 *
 * Date: Fri Aug 19 2011 8:58 AM -0500
 *
 * Usage:
 *	presentation.init([{"url":"/path/to/file.html", "title": "Some File", "sectionTitle": true},{"url":"/path/to/another-file.html", "title": "Some Other File"}], "previous", "next");
 */
;(function(){"use strict";String.prototype.toHash=function(){return'#'+this.replace(/,|\?/g,'').replace(/\s|\//g,'-').toLowerCase()};if(!window.addEventListener){window.addEventListener=function(a,b,c){attachEvent('on'+a,function(){b(event)})}}}());var presentation=(function(){"use strict";var g=0,totalSlides,myOutline,previousButton,nextButton,fadeElement=function(b,c,d,e){var f=(c==="In")?1:-1,targetAlpha=d||((c==="In")?100:0),alpha=b.style.opacity?parseFloat(b.style.opacity)*100:0,tween=function(){if(alpha===targetAlpha){clearInterval(b.si);if(typeof e==="function"){e()}}else{var a=Math.round(alpha+((targetAlpha-alpha)*0.05))+f;b.style.opacity=a/100;b.style.filter='alpha(opacity='+a+')';alpha=a}};clearInterval(b.si);b.si=setInterval(function(){tween()},20)},goToSlide=function(){var a=this;window.console.log("Link href: "+a.href+"\nLink href Hash: "+a.hash);document.location.hash=a.hash;document.location.reload()},setNavLinks=function(a){if(a){if(g>0){previousButton.style.visibility="visible";fadeElement(previousButton,"In")}if(g<(totalSlides-1)){nextButton.style.visibility="visible";fadeElement(nextButton,"In")}previousButton.href=(g>0)?myOutline[g-1].title.toHash():'#';nextButton.href=(g<(totalSlides-1))?myOutline[g+1].title.toHash():'#'}},setContent=function(a,b){var c=document.getElementById("slide");c.innerHTML=a;if(typeof b==="function"){b()}},requestContent=function(a,b){var c=false;if(window.XMLHttpRequest){c=new XMLHttpRequest()}else if(window.ActiveXObject){c=new ActiveXObject("Microsoft.XMLHTTP")}c.open('GET',a,false);c.onreadystatechange=function(){if(c.readyState===4){setContent(c.responseText,b)}};c.send()},setPageTitle=function(a){document.location.hash=a.title.toHash();document.getElementsByTagName("title")[0].innerHTML=a.title},attachEventListener=function(a){if(typeof a==="object"&&a.href!==null){a.addEventListener('click',goToSlide,false)}},createListItem=function(a){var b,anchor=document.createElement("a");anchor.className="outlineLink";anchor.href=a.title.toHash();anchor.innerHTML=a.title;attachEventListener(anchor);if(a.sectionTitle){b=document.createElement("h2");b.appendChild(anchor)}return(typeof b==="object")?b:anchor},loadTableOfContents=function(){var a=document.getElementById("slide"),slideTitle=document.getElementsByTagName("title")[0],contentDiv=document.createElement("div"),tableOfContents=document.createElement("div"),header=document.createElement("h1"),section=document.createElement("ol"),slide,list,listItem,i;tableOfContents.id="tableOfContents";contentDiv.id="content";contentDiv.className="content";g=-1;header.innerHTML="Table of Contents";contentDiv.appendChild(header);for(i in myOutline){if(myOutline.hasOwnProperty(i)){slide=myOutline[i];if(slide.sectionTitle){if(typeof list==="object"){section.appendChild(list)}section.appendChild(createListItem(slide));list=document.createElement("ol")}else{listItem=document.createElement("li");listItem.appendChild(createListItem(slide));list.appendChild(listItem)}}}section.appendChild(list);tableOfContents.appendChild(section);slideTitle.innerHTML="Table of Contents";contentDiv.appendChild(tableOfContents);a.appendChild(contentDiv);setNavLinks(false)},keyPress=function(e){if(e.keyCode===37&&(g>0)){window.console.log("Button Pressed: "+previousButton);goToSlide.apply(previousButton)}else if(e.keyCode===39&&(g<(totalSlides-1))){window.console.log("Button Pressed: "+nextButton);goToSlide.apply(nextButton)}},setPage=function(){var a=document.location.hash,initialSlide=myOutline[0],i=0,l=myOutline.length,slide;if(a){if(a==='#table-of-contents'){loadTableOfContents();return false}for(i;i<l;i=i+1){slide=myOutline[i];if(slide.title.toHash()===a){initialSlide=slide;g=i;break}}}attachEventListener(document.getElementById('tocLink'));document.addEventListener('keydown',keyPress,false);requestContent(initialSlide.url,function(){setPageTitle(initialSlide);setNavLinks(true)})},init=function(a,b,c,d){if(typeof a!=='object'||typeof b!=='string'||typeof c!=='string'||typeof d!=='string'){throw{name:'TypeError',message:'Initializing a presentation requires three values: outline, previousId and nextID'}}myOutline=a;previousButton=document.getElementById(b);nextButton=document.getElementById(c);totalSlides=myOutline.length;attachEventListener(previousButton);attachEventListener(nextButton);setPage();return true};return{init:init}}());